(function(e){function t(t){for(var o,c,l=t[0],i=t[1],d=t[2],u=0,p=[];u<l.length;u++)c=l[u],Object.prototype.hasOwnProperty.call(a,c)&&a[c]&&p.push(a[c][0]),a[c]=0;for(o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o]);s&&s(t);while(p.length)p.shift()();return r.push.apply(r,d||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],o=!0,l=1;l<n.length;l++){var i=n[l];0!==a[i]&&(o=!1)}o&&(r.splice(t--,1),e=c(c.s=n[0]))}return e}var o={},a={app:0},r=[];function c(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.m=e,c.c=o,c.d=function(e,t,n){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)c.d(n,o,function(t){return e[t]}.bind(null,o));return n},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="/context-ui/";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],i=l.push.bind(l);l.push=t,l=l.slice();for(var d=0;d<l.length;d++)t(l[d]);var s=i;r.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},"5d1f":function(e,t,n){"use strict";n("bd7d")},"861c":function(e,t,n){"use strict";n("f6f3")},bd7d:function(e,t,n){},cd49:function(e,t,n){"use strict";n.r(t);var o=n("5530"),a=n("d4ec"),r=n("bee2"),c=n("ade3"),l=(n("e260"),n("e6cf"),n("cca6"),n("a79d"),n("7db0"),n("7a23")),i=(n("a4d3"),n("e01a"),Object(l["createVNode"])("nav",{class:"navbar navbar-expand-lg navbar-light bg-light"},[Object(l["createVNode"])("div",{class:"container-fluid"},[Object(l["createVNode"])("a",{class:"navbar-brand",href:"#"},"Context UI"),Object(l["createVNode"])("div",{class:"collapse navbar-collapse",id:"navbarSupportedContent"},[Object(l["createVNode"])("ul",{class:"navbar-nav me-auto mb-2 mb-lg-0"},[Object(l["createVNode"])("li",{class:"nav-item dropdown"},[Object(l["createVNode"])("a",{class:"nav-link dropdown-toggle",href:"#",id:"navbarDropdown",role:"button","data-bs-toggle":"dropdown","aria-expanded":"false"}," File "),Object(l["createVNode"])("ul",{class:"dropdown-menu","aria-labelledby":"navbarDropdown"},[Object(l["createVNode"])("li",null,[Object(l["createVNode"])("a",{class:"dropdown-item",href:"#"},"Action")]),Object(l["createVNode"])("li",null,[Object(l["createVNode"])("a",{class:"dropdown-item",href:"#"},"Another action")]),Object(l["createVNode"])("li",null,[Object(l["createVNode"])("hr",{class:"dropdown-divider"})]),Object(l["createVNode"])("li",null,[Object(l["createVNode"])("a",{class:"dropdown-item",href:"#"},"Something else here")])])]),Object(l["createVNode"])("li",{class:"nav-item dropdown"},[Object(l["createVNode"])("a",{class:"nav-link dropdown-toggle",href:"#",id:"navbarDropdown",role:"button","data-bs-toggle":"dropdown","aria-expanded":"false"}," View "),Object(l["createVNode"])("ul",{class:"dropdown-menu","aria-labelledby":"navbarDropdown"},[Object(l["createVNode"])("li",null,[Object(l["createVNode"])("a",{class:"dropdown-item",href:"#"},"Action")]),Object(l["createVNode"])("li",null,[Object(l["createVNode"])("a",{class:"dropdown-item",href:"#"},"Another action")]),Object(l["createVNode"])("li",null,[Object(l["createVNode"])("hr",{class:"dropdown-divider"})]),Object(l["createVNode"])("li",null,[Object(l["createVNode"])("a",{class:"dropdown-item",href:"#"},"Something else here")])])]),Object(l["createVNode"])("li",{class:"nav-item dropdown"},[Object(l["createVNode"])("a",{class:"nav-link dropdown-toggle",href:"#",id:"navbarDropdown",role:"button","data-bs-toggle":"dropdown","aria-expanded":"false"}," Examples "),Object(l["createVNode"])("ul",{class:"dropdown-menu","aria-labelledby":"navbarDropdown"},[Object(l["createVNode"])("li",null,[Object(l["createVNode"])("a",{class:"dropdown-item",href:"#"},"Action")]),Object(l["createVNode"])("li",null,[Object(l["createVNode"])("a",{class:"dropdown-item",href:"#"},"Another action")]),Object(l["createVNode"])("li",null,[Object(l["createVNode"])("hr",{class:"dropdown-divider"})]),Object(l["createVNode"])("li",null,[Object(l["createVNode"])("a",{class:"dropdown-item",href:"#"},"Something else here")])])])]),Object(l["createVNode"])("form",{class:"d-flex"},[Object(l["createVNode"])("input",{class:"form-control me-2",type:"search",placeholder:"Search","aria-label":"Search"}),Object(l["createVNode"])("button",{class:"btn btn-outline-success",type:"submit"},"Search")])])])],-1)),d={class:"content"};function s(e,t,n,o,a,r){var c=Object(l["resolveComponent"])("Editor"),s=Object(l["resolveComponent"])("pane"),u=Object(l["resolveComponent"])("Diagram"),p=Object(l["resolveComponent"])("splitpanes"),h=Object(l["resolveComponent"])("Markdown");return Object(l["openBlock"])(),Object(l["createBlock"])(l["Fragment"],null,[i,Object(l["createVNode"])("div",d,[Object(l["createVNode"])(p,{horizontal:"",class:"custom-theme default-theme"},{default:Object(l["withCtx"])((function(){return[Object(l["createVNode"])(s,null,{default:Object(l["withCtx"])((function(){return[Object(l["createVNode"])(p,null,{default:Object(l["withCtx"])((function(){return[Object(l["createVNode"])(s,null,{default:Object(l["withCtx"])((function(){return[Object(l["createVNode"])(c,{contextMapYaml:e.contextMapYaml,onOnContextMapChanges:e.handleContextMapChanged},null,8,["contextMapYaml","onOnContextMapChanges"])]})),_:1}),Object(l["createVNode"])(s,{class:"scroll"},{default:Object(l["withCtx"])((function(){return[Object(l["createVNode"])(u,{contextMap:e.contextMap,onOnSelectContext:e.handleContextSelected,onOnContextPositionChanges:e.handleContextPositionChanged},null,8,["contextMap","onOnSelectContext","onOnContextPositionChanges"])]})),_:1})]})),_:1})]})),_:1}),Object(l["createVNode"])(s,{class:"scroll p-4"},{default:Object(l["withCtx"])((function(){var t;return[e.showDescription?(Object(l["openBlock"])(),Object(l["createBlock"])(h,{key:0,value:null===(t=e.selectedContext)||void 0===t?void 0:t.description},null,8,["value"])):Object(l["createCommentVNode"])("",!0)]})),_:1})]})),_:1})])],64)}function u(e,t,n,o,a,r){return Object(l["openBlock"])(),Object(l["createBlock"])("div",{onWheel:t[1]||(t[1]=Object(l["withModifiers"])((function(){return e.zoom&&e.zoom.apply(e,arguments)}),["alt","prevent"])),class:"draw-area h-100"},null,32)}var p=n("2909"),h=(n("99af"),n("5db7"),n("73d9"),n("159b"),n("4de4"),n("b0c0"),n("d81d"),n("d3b7"),n("6062"),n("3ca3"),n("ddb0"),n("ccc1")),f=n.n(h);window["mxBasePath"]="public/mxgraph";var x=f()({mxBasePath:"public/mxgraph"}),b=n("257e"),v=n("262e"),m=n("2caf"),g=function(e){return"_ctx_".concat(e)},O=100,C=10,j=20,y=3,w=30,M=10,V=function(e){var t,n;return new x.mxGeometry(null===(t=e.position)||void 0===t?void 0:t.x,null===(n=e.position)||void 0===n?void 0:n.y,O+2*C,O+2*C)},S={backgroundColor:"#FD506A",fontColor:"#1B1B1B",strokeColor:"#1B1B1B",position:{x:0,y:0}},N=function(e){Object(v["a"])(n,e);var t=Object(m["a"])(n);function n(e){var r,l;return Object(a["a"])(this,n),l=t.call(this,null,V(Object(o["a"])(Object(o["a"])({},S),e["x-viz-metadata"])),"".concat(x.mxConstants.STYLE_OPACITY,"=0;")),Object(c["a"])(Object(b["a"])(l),"contextVertex",void 0),Object(c["a"])(Object(b["a"])(l),"contextId",void 0),Object(c["a"])(Object(b["a"])(l),"generateStyleString",(function(e){var t=Object(o["a"])(Object(o["a"])({},S),e["x-viz-metadata"]),n="shape=ellipse;fontStyle=1";return n+=";".concat(x.mxConstants.STYLE_FILLCOLOR,"=").concat(t.backgroundColor),n+=";".concat(x.mxConstants.STYLE_FONTCOLOR,"=").concat(t.fontColor),n+=";".concat(x.mxConstants.STYLE_STROKECOLOR,"=").concat(t.strokeColor),n})),Object(c["a"])(Object(b["a"])(l),"getRelationTerminal",(function(e,t){var n={x:l.getGeometry().x,y:l.getGeometry().y},o={x:e.getGeometry().x,y:e.getGeometry().y},a=n.y>o.y,r={x:n.x-o.x,y:n.y-o.y},c={x:-1,y:0},i=r.x*c.x+r.y*c.y,d=Math.sqrt(Math.pow(r.x,2)+Math.pow(r.y,2)),s=Math.sqrt(Math.pow(c.x,2)+Math.pow(c.y,2)),u=Math.acos(i/(d*s)),p=Math.round(u*(180/Math.PI)),h="".concat(l.id,".").concat(e.id),f=l.getChild(h),v=t.length<y?w:t.length*M,m=new x.mxGeometry(118-v/2,50,v,j);m.rotate(a?360-p:p-360,new x.mxPoint(l.contextVertex.getGeometry().getCenterX(),l.contextVertex.getGeometry().getCenterY()));var g=a?90-p:p-90,O="fillColor=#60C487;strokeColor=#1B1B1B;rotation=".concat(g,";");if(f)return f.setStyle(O),f.setGeometry(m),f;var C=new x.mxCell(t,m,O);return C.id=h,C.parent=Object(b["a"])(l),C.vertex=!0,l.insert(C,l.getChildCount()),C})),Object(c["a"])(Object(b["a"])(l),"getChild",(function(e){var t=l.children.filter((function(t){return(null===t||void 0===t?void 0:t.id)===e}));if(0!=t.length)return t[0]})),l.contextId=e.id,l.id=g(e.id),l.vertex=!0,l.contextVertex=new x.mxCell(null!==(r=e.name)&&void 0!==r?r:e.id,new x.mxGeometry(C,10,O,O),l.generateStyleString(e)),l.contextVertex.id="".concat(l.id,".contextVertex"),l.contextVertex.parent=Object(b["a"])(l),l.contextVertex.vertex=!0,l.insert(l.contextVertex,l.getChildCount()),l}return Object(r["a"])(n,[{key:"update",value:function(e){var t;this.contextVertex.valueChanged(null!==(t=e.name)&&void 0!==t?t:e.id),this.contextVertex.setStyle(this.generateStyleString(e))}},{key:"removeRelationTerminal",value:function(e){var t="".concat(this.id,".").concat(e.id),n=this.getChild(t);n&&this.remove(this.getIndex(n))}}]),n}(x.mxCell),E=function e(t){return t?t instanceof N?t:t.parent?e(t.parent):void 0:void 0},k=function(e,t,n){var o=[].concat(Object(p["a"])(t),Object(p["a"])(t.flatMap((function(e){return e.children}))));e.setCellStyles(x.mxConstants.STYLE_FILL_OPACITY,n,o),e.setCellStyles(x.mxConstants.STYLE_TEXT_OPACITY,n,o),e.setCellStyles(x.mxConstants.STYLE_STROKE_OPACITY,n,o)},T=new x.mxEditor,Y=Object(l["defineComponent"])({name:"Diagram",data:function(){return Object(l["shallowReactive"])({visible:!0})},props:{contextMap:{type:Object,required:!0}},mounted:function(){if(x.mxClient.isBrowserSupported()){var e=this.$el;x.mxGraphHandler.prototype.guidesEnabled=!0,T.setGraphContainer(e);var t=T.graph;t.isCellFoldable=function(){return!1},t.isCellEditable=function(){return!1},t.isCellMovable=function(e){return e.isVertex()};var n=t.isCellSelectable;t.isCellSelectable=function(e){return n.apply(t,[e])&&!e.isEdge()&&e instanceof N},t.model.addListener(x.mxEvent.CHANGE,this.handleMxChange),t.addListener(x.mxEvent.CLICK,this.handleMxClick);var o=t.getStylesheet().getDefaultEdgeStyle();o[x.mxConstants.STYLE_STARTARROW]=x.mxConstants.NONE,o[x.mxConstants.STYLE_ENDARROW]=x.mxConstants.NONE,o[x.mxConstants.STYLE_STROKEWIDTH]="2",o[x.mxConstants.STYLE_STROKECOLOR]="#1B1B1B",this.updateGraph(this.renderContextMap)}else x.mxUtils.error("Browser is not supported!",200,!1)},updated:function(){this.updateGraph((function(e){e.model.clear()})),this.updateGraph(this.renderContextMap)},methods:{handleMxChange:function(e,t){var n=this;t.getProperty("edit").changes.filter((function(e){return"mxGeometryChange"===e.constructor.name})).forEach((function(e){var t=e,o=E(t.cell);o&&n.$emit("onContextPositionChanges",{contextId:o.contextId,position:{x:t.geometry.x,y:t.geometry.y}})}))},handleMxClick:function(e,t){var n=E(t.getProperty("cell")),o=e.getDefaultParent();n?(this.updateGraph((function(){var t=n.children.filter((function(e){return e.isVertex()})).flatMap((function(t){return e.getEdges(t)})),a=t.map((function(e){return E(e.source)===n?e.target:e.source})).filter((function(e){return!!e})).flatMap((function(e){if(e instanceof N)return[e];var t=E(e);return t?[e,t.contextVertex]:[e]})),r=e.getChildCells(o).flatMap((function(e){return h["mxCell"]instanceof N?h["mxCell"].children:[e]}));k(e,r,50),k(e,[n].concat(Object(p["a"])(t),Object(p["a"])(a)),100)})),this.$emit("onSelectContext",this.getAccordingContext(n))):(this.$emit("onSelectContext",null),k(e,e.getChildCells(o),100))},zoom:function(e){var t,n;e.deltaY>0?null===T||void 0===T||null===(t=T.graph)||void 0===t||t.zoomIn():null===T||void 0===T||null===(n=T.graph)||void 0===n||n.zoomOut()},getAccordingContext:function(e){return this.contextMap.contexts.filter((function(t){return t.id===e.contextId}))[0]},renderContextMap:function(e){var t=e.model,n=e.getDefaultParent(),o=new Set,a=new Set;this.contextMap.contexts.forEach((function(e){o.add(e.id),P(e)})),this.contextMap.contexts.forEach((function(e){I(e).forEach((function(e){return a.add(e)}))}));var r=[];t.getChildVertices(n).forEach((function(e){e instanceof N&&!o.has(e.contextId)&&r.push(e)})),t.getChildEdges(n).forEach((function(e){a.has(e.getId())||r.push(e)})),e.removeCells(r)},updateGraph:function(e){var t,n=null!==(t=null===T||void 0===T?void 0:T.graph)&&void 0!==t?t:_(),o=n.getModel();o.beginUpdate();try{e.apply(this,[n])}catch(a){console.error(a)}finally{o.endUpdate()}}}});function P(e){var t,n=null!==(t=null===T||void 0===T?void 0:T.graph)&&void 0!==t?t:_(),o=n.model,a=g(e.id);if(o.getCell(a)){var r=o.getCell(a);r.update(e)}else{var c=new N(e);n.addCell(c)}}function I(e){var t,n,o=new Set,a=null!==(t=null===T||void 0===T?void 0:T.graph)&&void 0!==t?t:_(),r=a.model,c=a.getDefaultParent();return null===(n=e.relations)||void 0===n||n.forEach((function(t){var n=g(e.id),l=g(t.target),i=r.getCell(n),d=r.getCell(l);if(i&&d){var s,u,p=d.contextVertex,h=i.contextVertex,f="".concat(e.id,"-").concat(t.target);if(t.targetType)p=null!==(s=d.getRelationTerminal(i,t.targetType))&&void 0!==s?s:_();if(t.sourceType)h=null!==(u=i.getRelationTerminal(d,t.sourceType))&&void 0!==u?u:_();if(!r.getCell(f)){var x=a.insertEdge(c,f,"",h,p,"");a.orderCells(!0,[x]),a.insertVertex(x,null,"U",.7,0,15,15,"fontSize=16;fontColor=#000000;fillColor=#ffffff;strokeColor=none;",!0),a.insertVertex(x,null,"D",-.7,0,10,10,"fontSize=16;fontColor=#000000;fillColor=#ffffff;strokeColor=none;",!0)}o.add(f)}})),o}function _(){throw new Error("")}n("5d1f");Y.render=u;var B=Y;function L(e,t,n,o,a,r){return Object(l["withDirectives"])((Object(l["openBlock"])(),Object(l["createBlock"])("textarea",{ref:"textarea","onUpdate:modelValue":t[1]||(t[1]=function(t){return e.content=t})},null,512)),[[l["vModelText"],e.content]])}var A=n("56b3"),D=n.n(A),G=(n("0dd0"),n("a7be"),n("7a7a"),n("ced0"),n("8822"),n("b8d1"),void 0),R=Object(l["defineComponent"])({name:"Editor",props:{contextMapYaml:{type:String,required:!0}},data:function(){return{content:this.$props.contextMapYaml,hasError:!1}},updated:function(){var e=this;if(this.content.normalize()!==this.contextMapYaml.normalize()&&(this.content=this.contextMapYaml,G)){var t=G;t.operation((function(){var n=t.getCursor(),o=t.getViewport();t.setValue(e.content),t.setCursor(n),t.scrollIntoView({ch:n.ch,line:o.to}),t.refresh()}))}},mounted:function(){var e=this;G=D.a.fromTextArea(this.$el,{lineNumbers:!0,mode:"text/x-yaml",gutters:["CodeMirror-lint-markers"],theme:"monokai",lint:!0}),G.setSize("100%","100%"),G.on("change",(function(t){t.getValue()!==e.contextMapYaml&&e.$emit("onContextMapChanges",t.getValue())}))}});R.render=L;var z=R;function $(e,t,n,o,a,r){return Object(l["openBlock"])(),Object(l["createBlock"])("div",{innerHTML:e.compiledMarkdown,class:"markdown-content"},null,8,["innerHTML"])}var F=n("0e54"),U=n.n(F),q=n("1487"),H=n.n(q),K=(n("b164"),["java","javscript","bash"]);U.a.setOptions({highlight:function(e,t){var n;return n=t&&K.indexOf(t)>-1?H.a.highlight(e,{language:t}):H.a.highlightAuto(e),n.value}});var W=Object(l["defineComponent"])({props:{value:{type:String,required:!0}},data:function(){return{compiledMarkdown:"",executionId:null}},watch:{value:{immediate:!0,handler:function(e){var t=this;console.log("parsing"),U()(e,{gfm:!0},(function(e,n){t.compiledMarkdown=n}))}}}});W.render=$;var J=W,X=n("512e"),Q=(n("c1ea"),Object(l["defineComponent"])({name:"App",components:{Diagram:B,Editor:z,Markdown:J,Splitpanes:X["Splitpanes"],Pane:X["Pane"]},data:function(){var e=Object(l["toRefs"])(this.$props.store.state),t=e.contextMap,n=e.contextMapYaml;return{contextMap:Object(l["readonly"])(t),contextMapYaml:Object(l["readonly"])(n)}},computed:{showDescription:function(){var e;return!(null===(e=this.selectedContext)||void 0===e||!e.description)},selectedContext:function(){var e=this.$props.store.state.selectedContextId;if(e)return this.$props.store.state.contextMap.contexts.find((function(t){return t.id===e}))}},methods:{handleContextMapChanged:function(e){this.store.updateContextMap(e)},handleContextSelected:function(e){this.store.handleContextSelected(e)},handleContextPositionChanged:function(e){this.store.handleContextPositionChanged(e)}},props:{store:{type:Object,required:!0}}}));n("861c");Q.render=s;var Z,ee=Q,te=n("e2c1"),ne=n("2ef0"),oe=n.n(ne);n("21b6"),n("b681");window.jsyaml=te["a"];var ae=function(e){try{var t=te["a"].load(e);return{contextMap:t}}catch(n){return console.log("Invalid YAML"),{contextMap:{contexts:[]},error:n}}},re=function(){function e(){Object(a["a"])(this,e),Object(c["a"])(this,"debug",!1),Object(c["a"])(this,"state",Object(l["reactive"])({contextMapYaml:ce,contextMap:ae(ce).contextMap,selectedContextId:null}))}return Object(r["a"])(e,[{key:"updateYaml",value:function(e){this.state.contextMapYaml=e,window.localStorage.setItem("lastMap",e)}},{key:"updateContextMap",value:function(e){this.debug&&console.log("setMessageAction triggered with",e);var t=ae(e),n=t.contextMap,o=t.error;o||(this.state.contextMap=n),this.updateYaml(e)}},{key:"handleContextSelected",value:function(e){var t;this.state.selectedContextId=null!==(t=null===e||void 0===e?void 0:e.id)&&void 0!==t?t:null}},{key:"handleContextPositionChanged",value:function(e){this.debug&&console.log("handleContextPositionChanged triggered with",e);var t=oe.a.cloneDeep(this.state.contextMap),n=t.contexts.find((function(t){return t.id===e.contextId}));if(n){var a=n["x-viz-metadata"];n["x-viz-metadata"]=Object(o["a"])(Object(o["a"])({},a),{},{position:{x:e.position.x<0?0:e.position.x,y:e.position.y<0?0:e.position.y}});try{var r=te["a"].dump(t,{skipInvalid:!0,lineWidth:-1});this.updateYaml(r),this.state.contextMap=t,console.log(["Updated Position",e,t,r])}catch(c){console.log(c)}}}}]),e}(),ce=null!==(Z=window.localStorage.getItem("lastMap"))&&void 0!==Z?Z:"---\ncontexts:\n  - id: test\n    name: test\n    relations:\n      - target: test2\n  - id: test2\n    name: test-2",le=new re,ie=Object(l["createApp"])(ee,{store:le});ie.mount("#app")},f6f3:function(e,t,n){}});
//# sourceMappingURL=app.b8cc38a4.js.map
(function(t){function e(e){for(var o,i,c=e[0],l=e[1],s=e[2],u=0,p=[];u<c.length;u++)i=c[u],Object.prototype.hasOwnProperty.call(a,i)&&a[i]&&p.push(a[i][0]),a[i]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(t[o]=l[o]);d&&d(e);while(p.length)p.shift()();return r.push.apply(r,s||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],o=!0,c=1;c<n.length;c++){var l=n[c];0!==a[l]&&(o=!1)}o&&(r.splice(e--,1),t=i(i.s=n[0]))}return t}var o={},a={app:0},r=[];function i(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=o,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],l=c.push.bind(c);c.push=e,c=c.slice();for(var s=0;s<c.length;s++)e(c[s]);var d=l;r.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("cd49")},"7bec":function(t,e,n){},bc1b:function(t,e,n){"use strict";n("7bec")},cd49:function(t,e,n){"use strict";n.r(e);var o=n("5530"),a=n("d4ec"),r=n("bee2"),i=n("ade3"),c=(n("e260"),n("e6cf"),n("cca6"),n("a79d"),n("7db0"),n("7a23")),l=(n("a4d3"),n("e01a"),Object(c["e"])("nav",{class:"navbar"},[Object(c["e"])("div",{class:"container-fluid"},[Object(c["e"])("div",{class:"brand"},"Context-Mapper")])],-1)),s={class:"content"},d={class:"dev"},u={class:"editor"},p={class:"diagram"},f={class:"markdown"};function h(t,e,n,o,a,r){var i,h=Object(c["j"])("Editor"),x=Object(c["j"])("Diagram"),v=Object(c["j"])("Markdown");return Object(c["g"])(),Object(c["c"])(c["a"],null,[l,Object(c["e"])("div",s,[Object(c["e"])("div",d,[Object(c["e"])("div",u,[Object(c["e"])(h,{contextMapYaml:t.contextMapYaml,onOnContextMapChanges:t.handleContextMapChanged},null,8,["contextMapYaml","onOnContextMapChanges"])]),Object(c["e"])("div",p,[Object(c["e"])(x,{contextMap:t.contextMap,onOnSelectContext:t.handleContextSelected,onOnContextPositionChanges:t.handleContextPositionChanged},null,8,["contextMap","onOnSelectContext","onOnContextPositionChanges"])])]),Object(c["e"])("div",f,[t.showDescription?(Object(c["g"])(),Object(c["c"])(v,{key:0,value:null===(i=t.selectedContext)||void 0===i?void 0:i.description},null,8,["value"])):Object(c["d"])("",!0)])])],64)}function x(t,e,n,o,a,r){return Object(c["g"])(),Object(c["c"])("div",{onWheel:e[1]||(e[1]=Object(c["o"])((function(){return t.zoom&&t.zoom.apply(t,arguments)}),["alt","prevent"])),class:"draw-area h-100"},null,32)}var v=n("2909"),g=(n("99af"),n("5db7"),n("73d9"),n("159b"),n("4de4"),n("b0c0"),n("d81d"),n("d3b7"),n("6062"),n("3ca3"),n("ddb0"),n("ccc1")),C=n.n(g);window["mxBasePath"]="public/mxgraph";var m=C()({mxBasePath:"public/mxgraph"}),b=n("257e"),O=n("262e"),y=n("2caf"),j=function(t){return"_ctx_".concat(t)},M=100,S=10,w=20,E=3,T=30,Y=10,k=function(t){var e,n;return new m.mxGeometry(null===(e=t.position)||void 0===e?void 0:e.x,null===(n=t.position)||void 0===n?void 0:n.y,M+2*S,M+2*S)},P={backgroundColor:"#FD506A",fontColor:"#1B1B1B",strokeColor:"#1B1B1B",position:{x:0,y:0}},I=function(t){Object(O["a"])(n,t);var e=Object(y["a"])(n);function n(t){var r,c;return Object(a["a"])(this,n),c=e.call(this,null,k(Object(o["a"])(Object(o["a"])({},P),t["x-viz-metadata"])),"".concat(m.mxConstants.STYLE_OPACITY,"=0;")),Object(i["a"])(Object(b["a"])(c),"contextVertex",void 0),Object(i["a"])(Object(b["a"])(c),"contextId",void 0),Object(i["a"])(Object(b["a"])(c),"generateStyleString",(function(t){var e=Object(o["a"])(Object(o["a"])({},P),t["x-viz-metadata"]),n="shape=ellipse;fontStyle=1";return n+=";".concat(m.mxConstants.STYLE_FILLCOLOR,"=").concat(e.backgroundColor),n+=";".concat(m.mxConstants.STYLE_FONTCOLOR,"=").concat(e.fontColor),n+=";".concat(m.mxConstants.STYLE_STROKECOLOR,"=").concat(e.strokeColor),n})),Object(i["a"])(Object(b["a"])(c),"getRelationTerminal",(function(t,e){var n={x:c.getGeometry().x,y:c.getGeometry().y},o={x:t.getGeometry().x,y:t.getGeometry().y},a=n.y>o.y,r={x:n.x-o.x,y:n.y-o.y},i={x:-1,y:0},l=r.x*i.x+r.y*i.y,s=Math.sqrt(Math.pow(r.x,2)+Math.pow(r.y,2)),d=Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2)),u=Math.acos(l/(s*d)),p=Math.round(u*(180/Math.PI)),f="".concat(c.id,".").concat(t.id),h=c.getChild(f),x=e.length<E?T:e.length*Y,v=new m.mxGeometry(118-x/2,50,x,w);v.rotate(a?360-p:p-360,new m.mxPoint(c.contextVertex.getGeometry().getCenterX(),c.contextVertex.getGeometry().getCenterY()));var g=a?90-p:p-90,C="fillColor=#60C487;strokeColor=#1B1B1B;rotation=".concat(g,";");if(h)return h.setStyle(C),h.setGeometry(v),h;var O=new m.mxCell(e,v,C);return O.id=f,O.parent=Object(b["a"])(c),O.vertex=!0,c.insert(O,c.getChildCount()),O})),Object(i["a"])(Object(b["a"])(c),"getChild",(function(t){var e=c.children.filter((function(e){return(null===e||void 0===e?void 0:e.id)===t}));if(0!=e.length)return e[0]})),c.contextId=t.id,c.id=j(t.id),c.vertex=!0,c.contextVertex=new m.mxCell(null!==(r=t.name)&&void 0!==r?r:t.id,new m.mxGeometry(S,10,M,M),c.generateStyleString(t)),c.contextVertex.id="".concat(c.id,".contextVertex"),c.contextVertex.parent=Object(b["a"])(c),c.contextVertex.vertex=!0,c.insert(c.contextVertex,c.getChildCount()),c}return Object(r["a"])(n,[{key:"update",value:function(t){var e;this.contextVertex.valueChanged(null!==(e=t.name)&&void 0!==e?e:t.id),this.contextVertex.setStyle(this.generateStyleString(t))}},{key:"removeRelationTerminal",value:function(t){var e="".concat(this.id,".").concat(t.id),n=this.getChild(e);n&&this.remove(this.getIndex(n))}}]),n}(m.mxCell),L=function t(e){return e?e instanceof I?e:e.parent?t(e.parent):void 0:void 0},V=function(t,e,n){var o=[].concat(Object(v["a"])(e),Object(v["a"])(e.flatMap((function(t){return t.children}))));t.setCellStyles(m.mxConstants.STYLE_FILL_OPACITY,n,o),t.setCellStyles(m.mxConstants.STYLE_TEXT_OPACITY,n,o),t.setCellStyles(m.mxConstants.STYLE_STROKE_OPACITY,n,o)},_=new m.mxEditor,G=Object(c["f"])({name:"Diagram",data:function(){return Object(c["k"])({visible:!0})},props:{contextMap:{type:Object,required:!0}},mounted:function(){if(m.mxClient.isBrowserSupported()){var t=this.$el;_.setGraphContainer(t);var e=_.graph;e.isCellFoldable=function(){return!1},e.isCellEditable=function(){return!1},e.isCellMovable=function(t){return t.isVertex()};var n=e.isCellSelectable;e.isCellSelectable=function(t){return n.apply(e,[t])&&!t.isEdge()&&t instanceof I},e.model.addListener(m.mxEvent.CHANGE,this.handleMxChange),e.addListener(m.mxEvent.CLICK,this.handleMxClick);var o=e.getStylesheet().getDefaultEdgeStyle();o[m.mxConstants.STYLE_STARTARROW]=m.mxConstants.NONE,o[m.mxConstants.STYLE_ENDARROW]=m.mxConstants.NONE,o[m.mxConstants.STYLE_STROKEWIDTH]="2",o[m.mxConstants.STYLE_STROKECOLOR]="#1B1B1B",this.updateGraph(this.renderContextMap)}else m.mxUtils.error("Browser is not supported!",200,!1)},updated:function(){this.updateGraph((function(t){t.model.clear()})),this.updateGraph(this.renderContextMap)},methods:{handleMxChange:function(t,e){var n=this;e.getProperty("edit").changes.filter((function(t){return"mxGeometryChange"===t.constructor.name})).forEach((function(t){var e=t,o=L(e.cell);o&&n.$emit("onContextPositionChanges",{contextId:o.contextId,position:{x:e.geometry.x,y:e.geometry.y}})}))},handleMxClick:function(t,e){var n=L(e.getProperty("cell")),o=t.getDefaultParent();n?(this.updateGraph((function(){var e=n.children.filter((function(t){return t.isVertex()})).flatMap((function(e){return t.getEdges(e)})),a=e.map((function(t){return L(t.source)===n?t.target:t.source})).filter((function(t){return!!t})).flatMap((function(t){if(t instanceof I)return[t];var e=L(t);return e?[t,e.contextVertex]:[t]})),r=t.getChildCells(o).flatMap((function(t){return g["mxCell"]instanceof I?g["mxCell"].children:[t]}));V(t,r,50),V(t,[n].concat(Object(v["a"])(e),Object(v["a"])(a)),100)})),this.$emit("onSelectContext",this.getAccordingContext(n))):(this.$emit("onSelectContext",null),V(t,t.getChildCells(o),100))},zoom:function(t){var e,n;t.deltaY>0?null===_||void 0===_||null===(e=_.graph)||void 0===e||e.zoomIn():null===_||void 0===_||null===(n=_.graph)||void 0===n||n.zoomOut()},getAccordingContext:function(t){return this.contextMap.contexts.filter((function(e){return e.id===t.contextId}))[0]},renderContextMap:function(t){var e=t.model,n=t.getDefaultParent(),o=new Set,a=new Set;this.contextMap.contexts.forEach((function(t){o.add(t.id),R(t)})),this.contextMap.contexts.forEach((function(t){A(t).forEach((function(t){return a.add(t)}))}));var r=[];e.getChildVertices(n).forEach((function(t){t instanceof I&&!o.has(t.contextId)&&r.push(t)})),e.getChildEdges(n).forEach((function(t){a.has(t.getId())||r.push(t)})),t.removeCells(r)},updateGraph:function(t){var e,n=null!==(e=null===_||void 0===_?void 0:_.graph)&&void 0!==e?e:B(),o=n.getModel();o.beginUpdate();try{t.apply(this,[n])}catch(a){console.error(a)}finally{o.endUpdate()}}}});function R(t){var e,n=null!==(e=null===_||void 0===_?void 0:_.graph)&&void 0!==e?e:B(),o=n.model,a=j(t.id);if(o.getCell(a)){var r=o.getCell(a);r.update(t)}else{var i=new I(t);n.addCell(i)}}function A(t){var e,n,o=new Set,a=null!==(e=null===_||void 0===_?void 0:_.graph)&&void 0!==e?e:B(),r=a.model,i=a.getDefaultParent();return null===(n=t.relations)||void 0===n||n.forEach((function(e){var n=j(t.id),c=j(e.target),l=r.getCell(n),s=r.getCell(c);if(l&&s){var d,u,p=s.contextVertex,f=l.contextVertex,h="".concat(t.id,"-").concat(e.target);if(e.targetType)p=null!==(d=s.getRelationTerminal(l,e.targetType))&&void 0!==d?d:B();if(e.sourceType)f=null!==(u=l.getRelationTerminal(s,e.sourceType))&&void 0!==u?u:B();if(!r.getCell(h)){var x=a.insertEdge(i,h,"",f,p,"");a.orderCells(!0,[x]),a.insertVertex(x,null,"U",.7,0,15,15,"fontSize=16;fontColor=#000000;fillColor=#ffffff;strokeColor=none;",!0),a.insertVertex(x,null,"D",-.7,0,10,10,"fontSize=16;fontColor=#000000;fillColor=#ffffff;strokeColor=none;",!0)}o.add(h)}})),o}function B(){throw new Error("")}n("ff66");G.render=x;var z=G;function D(t,e,n,o,a,r){return Object(c["n"])((Object(c["g"])(),Object(c["c"])("textarea",{ref:"textarea","onUpdate:modelValue":e[1]||(e[1]=function(e){return t.content=e})},null,512)),[[c["m"],t.content]])}var $=n("56b3"),N=n.n($),q=(n("0dd0"),n("a7be"),n("7a7a"),n("ced0"),n("8822"),n("b8d1"),void 0),U=Object(c["f"])({name:"Editor",props:{contextMapYaml:{type:String,required:!0}},data:function(){return{content:this.$props.contextMapYaml,hasError:!1}},updated:function(){var t=this;if(this.content.normalize()!==this.contextMapYaml.normalize()&&(this.content=this.contextMapYaml,q)){var e=q;e.operation((function(){var n=e.getCursor(),o=e.getViewport();e.setValue(t.content),e.setCursor(n),e.scrollIntoView({ch:n.ch,line:o.to}),e.refresh()}))}},mounted:function(){var t=this;q=N.a.fromTextArea(this.$el,{lineNumbers:!0,mode:"text/x-yaml",gutters:["CodeMirror-lint-markers"],theme:"monokai",lint:!0}),q.setSize("100%","100%"),q.on("change",(function(e){e.getValue()!==t.contextMapYaml&&t.$emit("onContextMapChanges",e.getValue())}))}});U.render=D;var F=U;function K(t,e,n,o,a,r){return Object(c["g"])(),Object(c["c"])("div",{innerHTML:t.compiledMarkdown,class:"markdown-content"},null,8,["innerHTML"])}var W=n("0e54"),H=n.n(W),J=n("1487"),X=n.n(J),Q=(n("b164"),["java","javscript","bash"]);H.a.setOptions({highlight:function(t,e){var n;return n=e&&Q.indexOf(e)>-1?X.a.highlight(t,{language:e}):X.a.highlightAuto(t),n.value}});var Z=Object(c["f"])({props:{value:{type:String,required:!0}},computed:{compiledMarkdown:function(){return H()(this.value,{gfm:!0})}}});Z.render=K;var tt=Z,et=Object(c["f"])({name:"App",components:{Diagram:z,Editor:F,Markdown:tt},data:function(){var t=Object(c["l"])(this.$props.store.state),e=t.contextMap,n=t.contextMapYaml;return{contextMap:Object(c["i"])(e),contextMapYaml:Object(c["i"])(n)}},computed:{showDescription:function(){var t;return!(null===(t=this.selectedContext)||void 0===t||!t.description)},selectedContext:function(){var t,e=this.$props.store.state.selectedContextId;return e&&null!==(t=this.$props.store.state.contextMap.contexts.find((function(t){return t.id===e})))&&void 0!==t?t:null}},methods:{handleContextMapChanged:function(t){this.store.updateContextMap(t)},handleContextSelected:function(t){this.store.handleContextSelected(t)},handleContextPositionChanged:function(t){this.store.handleContextPositionChanged(t)}},props:{store:{type:Object,required:!0}}});n("bc1b");et.render=h;var nt,ot=et,at=n("e2c1"),rt=n("2ef0"),it=n.n(rt);window.jsyaml=at["a"];var ct=function(t){try{var e=at["a"].load(t);return{contextMap:e}}catch(n){return console.log("Invalid YAML"),{contextMap:{contexts:[]},error:n}}},lt=function(){function t(){Object(a["a"])(this,t),Object(i["a"])(this,"debug",!1),Object(i["a"])(this,"state",Object(c["h"])({contextMapYaml:st,contextMap:ct(st).contextMap,selectedContextId:null}))}return Object(r["a"])(t,[{key:"updateYaml",value:function(t){this.state.contextMapYaml=t,window.localStorage.setItem("lastMap",t)}},{key:"updateContextMap",value:function(t){this.debug&&console.log("setMessageAction triggered with",t);var e=ct(t),n=e.contextMap,o=e.error;o||(this.state.contextMap=n),this.updateYaml(t)}},{key:"handleContextSelected",value:function(t){var e;this.state.selectedContextId=null!==(e=null===t||void 0===t?void 0:t.id)&&void 0!==e?e:null}},{key:"handleContextPositionChanged",value:function(t){this.debug&&console.log("handleContextPositionChanged triggered with",t);var e=it.a.cloneDeep(this.state.contextMap),n=e.contexts.find((function(e){return e.id===t.contextId}));if(n){var a=n["x-viz-metadata"];n["x-viz-metadata"]=Object(o["a"])(Object(o["a"])({},a),{},{position:{x:t.position.x<0?0:t.position.x,y:t.position.y<0?0:t.position.y}});try{var r=at["a"].dump(e,{skipInvalid:!0,lineWidth:-1});this.updateYaml(r),this.state.contextMap=e,console.log(["Updated Position",t,e,r])}catch(i){console.log(i)}}}}]),t}(),st=null!==(nt=window.localStorage.getItem("lastMap"))&&void 0!==nt?nt:"---\ncontexts:\n  - id: test\n    name: test\n    relations:\n      - target: test2\n  - id: test2\n    name: test-2",dt=new lt,ut=Object(c["b"])(ot,{store:dt});ut.mount("#app")},ceb2:function(t,e,n){},ff66:function(t,e,n){"use strict";n("ceb2")}});
//# sourceMappingURL=app.fbd6bbe2.js.map
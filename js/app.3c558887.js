(function(t){function e(e){for(var o,i,c=e[0],l=e[1],d=e[2],u=0,p=[];u<c.length;u++)i=c[u],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&p.push(r[i][0]),r[i]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(t[o]=l[o]);s&&s(e);while(p.length)p.shift()();return a.push.apply(a,d||[]),n()}function n(){for(var t,e=0;e<a.length;e++){for(var n=a[e],o=!0,c=1;c<n.length;c++){var l=n[c];0!==r[l]&&(o=!1)}o&&(a.splice(e--,1),t=i(i.s=n[0]))}return t}var o={},r={app:0},a=[];function i(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=o,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],l=c.push.bind(c);c.push=e,c=c.slice();for(var d=0;d<c.length;d++)e(c[d]);var s=l;a.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("cd49")},"3c1e":function(t,e,n){},"868e":function(t,e,n){"use strict";n("3c1e")},c075:function(t,e,n){"use strict";n("dfe4")},cd49:function(t,e,n){"use strict";n.r(e);var o=n("5530"),r=n("d4ec"),a=n("bee2"),i=n("ade3"),c=(n("e260"),n("e6cf"),n("cca6"),n("a79d"),n("7db0"),n("7a23")),l=(n("a4d3"),n("e01a"),{class:"editor"}),d={class:"diagram"},s={class:"markdown"};function u(t,e,n,o,r,a){var i,u=Object(c["j"])("Editor"),p=Object(c["j"])("Diagram"),f=Object(c["j"])("Markdown");return Object(c["g"])(),Object(c["c"])(c["a"],null,[Object(c["e"])("div",l,[Object(c["e"])(u,{contextMapYaml:t.contextMapYaml,onOnContextMapChanges:t.handleContextMapChanged},null,8,["contextMapYaml","onOnContextMapChanges"])]),Object(c["e"])("div",d,[Object(c["e"])(p,{contextMap:t.contextMap,onOnSelectContext:t.handleContextSelected,onOnContextPositionChanges:t.handleContextPositionChanged},null,8,["contextMap","onOnSelectContext","onOnContextPositionChanges"])]),Object(c["e"])("div",s,[t.showDescription?(Object(c["g"])(),Object(c["c"])(f,{key:0,value:null===(i=t.selectedContext)||void 0===i?void 0:i.description},null,8,["value"])):Object(c["d"])("",!0)])],64)}function p(t,e,n,o,r,a){return Object(c["g"])(),Object(c["c"])("div",{onWheel:e[1]||(e[1]=Object(c["o"])((function(){return t.zoom&&t.zoom.apply(t,arguments)}),["alt","prevent"])),class:"draw-area h-100"},null,32)}var f=n("2909"),h=(n("99af"),n("5db7"),n("73d9"),n("159b"),n("4de4"),n("b0c0"),n("d81d"),n("d3b7"),n("6062"),n("3ca3"),n("ddb0"),n("ccc1")),x=n.n(h);window["mxBasePath"]="public/mxgraph";var v=x()({mxBasePath:"public/mxgraph"}),g=n("257e"),m=n("262e"),C=n("2caf"),b=function(t){return"_ctx_".concat(t)},O=100,y=10,j=20,M=3,w=30,S=10,k=function(t){var e,n;return new v.mxGeometry(null===(e=t.position)||void 0===e?void 0:e.x,null===(n=t.position)||void 0===n?void 0:n.y,O+2*y,O+2*y)},E={backgroundColor:"#FD506A",fontColor:"#1B1B1B",strokeColor:"#1B1B1B",position:{x:0,y:0}},P=function(t){Object(m["a"])(n,t);var e=Object(C["a"])(n);function n(t){var a,c;return Object(r["a"])(this,n),c=e.call(this,null,k(Object(o["a"])(Object(o["a"])({},E),t["x-viz-metadata"])),"".concat(v.mxConstants.STYLE_OPACITY,"=0;")),Object(i["a"])(Object(g["a"])(c),"contextVertex",void 0),Object(i["a"])(Object(g["a"])(c),"contextId",void 0),Object(i["a"])(Object(g["a"])(c),"generateStyleString",(function(t){var e=Object(o["a"])(Object(o["a"])({},E),t["x-viz-metadata"]),n="shape=ellipse;fontStyle=1";return n+=";".concat(v.mxConstants.STYLE_FILLCOLOR,"=").concat(e.backgroundColor),n+=";".concat(v.mxConstants.STYLE_FONTCOLOR,"=").concat(e.fontColor),n+=";".concat(v.mxConstants.STYLE_STROKECOLOR,"=").concat(e.strokeColor),n})),Object(i["a"])(Object(g["a"])(c),"getRelationTerminal",(function(t,e){var n={x:c.getGeometry().x,y:c.getGeometry().y},o={x:t.getGeometry().x,y:t.getGeometry().y},r=n.y>o.y,a={x:n.x-o.x,y:n.y-o.y},i={x:-1,y:0},l=a.x*i.x+a.y*i.y,d=Math.sqrt(Math.pow(a.x,2)+Math.pow(a.y,2)),s=Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2)),u=Math.acos(l/(d*s)),p=Math.round(u*(180/Math.PI)),f="".concat(c.id,".").concat(t.id),h=c.getChild(f),x=e.length<M?w:e.length*S,m=new v.mxGeometry(118-x/2,50,x,j);m.rotate(r?360-p:p-360,new v.mxPoint(c.contextVertex.getGeometry().getCenterX(),c.contextVertex.getGeometry().getCenterY()));var C=r?90-p:p-90,b="fillColor=#5BCCAF;strokeColor=#1B1B1B;rotation=".concat(C,";");if(h)return h.setStyle(b),h.setGeometry(m),h;var O=new v.mxCell(e,m,b);return O.id=f,O.parent=Object(g["a"])(c),O.vertex=!0,c.insert(O,c.getChildCount()),O})),Object(i["a"])(Object(g["a"])(c),"getChild",(function(t){var e=c.children.filter((function(e){return(null===e||void 0===e?void 0:e.id)===t}));if(0!=e.length)return e[0]})),c.contextId=t.id,c.id=b(t.id),c.vertex=!0,c.contextVertex=new v.mxCell(null!==(a=t.name)&&void 0!==a?a:t.id,new v.mxGeometry(y,10,O,O),c.generateStyleString(t)),c.contextVertex.id="".concat(c.id,".contextVertex"),c.contextVertex.parent=Object(g["a"])(c),c.contextVertex.vertex=!0,c.insert(c.contextVertex,c.getChildCount()),c}return Object(a["a"])(n,[{key:"update",value:function(t){var e;this.contextVertex.valueChanged(null!==(e=t.name)&&void 0!==e?e:t.id),this.contextVertex.setStyle(this.generateStyleString(t))}},{key:"removeRelationTerminal",value:function(t){var e="".concat(this.id,".").concat(t.id),n=this.getChild(e);n&&this.remove(this.getIndex(n))}}]),n}(v.mxCell),Y=function t(e){return e?e instanceof P?e:e.parent?t(e.parent):void 0:void 0},T=function(t,e,n){var o=[].concat(Object(f["a"])(e),Object(f["a"])(e.flatMap((function(t){return t.children}))));t.setCellStyles(v.mxConstants.STYLE_FILL_OPACITY,n,o),t.setCellStyles(v.mxConstants.STYLE_TEXT_OPACITY,n,o),t.setCellStyles(v.mxConstants.STYLE_STROKE_OPACITY,n,o)},I=new v.mxEditor,V=Object(c["f"])({name:"Diagram",data:function(){return Object(c["k"])({visible:!0})},props:{contextMap:{type:Object,required:!0}},mounted:function(){if(v.mxClient.isBrowserSupported()){var t=this.$el;I.setGraphContainer(t);var e=I.graph;e.isCellFoldable=function(){return!1},e.isCellEditable=function(){return!1},e.isCellMovable=function(t){return t.isVertex()};var n=e.isCellSelectable;e.isCellSelectable=function(t){return n.apply(e,[t])&&!t.isEdge()&&t instanceof P},e.model.addListener(v.mxEvent.CHANGE,this.handleMxChange),e.addListener(v.mxEvent.CLICK,this.handleMxClick),this.updateGraph(this.renderContextMap)}else v.mxUtils.error("Browser is not supported!",200,!1)},updated:function(){this.updateGraph((function(t){t.model.clear()})),this.updateGraph(this.renderContextMap)},methods:{handleMxChange:function(t,e){var n=this;e.getProperty("edit").changes.filter((function(t){return"mxGeometryChange"===t.constructor.name})).forEach((function(t){var e=t,o=Y(e.cell);o&&n.$emit("onContextPositionChanges",{contextId:o.contextId,position:{x:e.geometry.x,y:e.geometry.y}})}))},handleMxClick:function(t,e){var n=Y(e.getProperty("cell")),o=t.getDefaultParent();n?(this.updateGraph((function(){var e=n.children.filter((function(t){return t.isVertex()})).flatMap((function(e){return t.getEdges(e)})),r=e.map((function(t){return Y(t.source)===n?t.target:t.source})).filter((function(t){return!!t})).flatMap((function(t){if(t instanceof P)return[t];var e=Y(t);return e?[t,e.contextVertex]:[t]})),a=t.getChildCells(o).flatMap((function(t){return h["mxCell"]instanceof P?h["mxCell"].children:[t]}));T(t,a,50),T(t,[n].concat(Object(f["a"])(e),Object(f["a"])(r)),100)})),this.$emit("onSelectContext",this.getAccordingContext(n))):(this.$emit("onSelectContext",null),T(t,t.getChildCells(o),100))},zoom:function(t){var e,n;t.deltaY>0?null===I||void 0===I||null===(e=I.graph)||void 0===e||e.zoomIn():null===I||void 0===I||null===(n=I.graph)||void 0===n||n.zoomOut()},getAccordingContext:function(t){return this.contextMap.contexts.filter((function(e){return e.id===t.contextId}))[0]},renderContextMap:function(t){var e=t.model,n=t.getDefaultParent(),o=new Set,r=new Set;this.contextMap.contexts.forEach((function(t){o.add(t.id),L(t)})),this.contextMap.contexts.forEach((function(t){G(t).forEach((function(t){return r.add(t)}))}));var a=[];e.getChildVertices(n).forEach((function(t){t instanceof P&&!o.has(t.contextId)&&a.push(t)})),e.getChildEdges(n).forEach((function(t){r.has(t.getId())||a.push(t)})),t.removeCells(a)},updateGraph:function(t){var e,n=null!==(e=null===I||void 0===I?void 0:I.graph)&&void 0!==e?e:_(),o=n.getModel();o.beginUpdate();try{t.apply(this,[n])}catch(r){console.error(r)}finally{o.endUpdate()}}}});function L(t){var e,n=null!==(e=null===I||void 0===I?void 0:I.graph)&&void 0!==e?e:_(),o=n.model,r=b(t.id);if(o.getCell(r)){var a=o.getCell(r);a.update(t)}else{var i=new P(t);n.addCell(i)}}function G(t){var e,n,o=new Set,r=null!==(e=null===I||void 0===I?void 0:I.graph)&&void 0!==e?e:_(),a=r.model,i=r.getDefaultParent();return null===(n=t.relations)||void 0===n||n.forEach((function(e){var n=b(t.id),c=b(e.target),l=a.getCell(n),d=a.getCell(c);if(l&&d){var s,u,p=d.contextVertex,f=l.contextVertex,h="".concat(t.id,"-").concat(e.target);if(e.targetType)p=null!==(s=d.getRelationTerminal(l,e.targetType))&&void 0!==s?s:_();if(e.sourceType)f=null!==(u=l.getRelationTerminal(d,e.sourceType))&&void 0!==u?u:_();if(!a.getCell(h)){var x=r.insertEdge(i,h,"",f,p,"startArrow=none;endArrow=none;strokeWidth=2;strokeColor=#1B1B1B;entryX=0.5;entryY=0.5;exitX=0.5;exitY=0.5;exitPerimeter=0;entryPerimeter=0;");r.orderCells(!0,[x]),r.insertVertex(x,null,"U",.7,0,1,1,"fontSize=16;fontColor=#000000;fillColor=#ffffff;strokeColor=none;",!0),r.insertVertex(x,null,"D",-.7,0,1,1,"fontSize=16;fontColor=#000000;fillColor=#ffffff;strokeColor=none;rounded=1;arcSize=25;strokeWidth=3;",!0)}o.add(h)}})),o}function _(){throw new Error("")}n("868e");V.render=p;var B=V;function A(t,e,n,o,r,a){return Object(c["n"])((Object(c["g"])(),Object(c["c"])("textarea",{ref:"textarea","onUpdate:modelValue":e[1]||(e[1]=function(e){return t.content=e})},null,512)),[[c["m"],t.content]])}var z=n("56b3"),D=n.n(z),$=(n("0dd0"),n("a7be"),n("7a7a"),n("ced0"),n("8822"),n("b8d1"),void 0),R=Object(c["f"])({name:"Editor",props:{contextMapYaml:{type:String,required:!0}},data:function(){return{content:this.$props.contextMapYaml,hasError:!1}},updated:function(){var t=this;if(this.content.normalize()!==this.contextMapYaml.normalize()&&(this.content=this.contextMapYaml,$)){var e=$;e.operation((function(){var n=e.getCursor(),o=e.getViewport();e.setValue(t.content),e.setCursor(n),e.scrollIntoView({ch:n.ch,line:o.to}),e.refresh()}))}},mounted:function(){var t=this;$=D.a.fromTextArea(this.$el,{lineNumbers:!0,mode:"text/x-yaml",gutters:["CodeMirror-lint-markers"],theme:"monokai",lint:!0}),$.setSize("100%","100%"),$.on("change",(function(e){e.getValue()!==t.contextMapYaml&&t.$emit("onContextMapChanges",e.getValue())}))}});R.render=A;var q=R;function F(t,e,n,o,r,a){return Object(c["g"])(),Object(c["c"])("div",{innerHTML:t.compiledMarkdown,class:"markdown-content"},null,8,["innerHTML"])}var U=n("0e54"),W=n.n(U),X=n("1487"),H=n.n(X),K=(n("b164"),["java","javscript","bash"]);W.a.setOptions({highlight:function(t,e){var n;return n=e&&K.indexOf(e)>-1?H.a.highlight(t,{language:e}):H.a.highlightAuto(t),n.value}});var N=Object(c["f"])({props:{value:{type:String,required:!0}},computed:{compiledMarkdown:function(){return W()(this.value,{gfm:!0})}}});N.render=F;var J=N,Q=Object(c["f"])({name:"App",components:{Diagram:B,Editor:q,Markdown:J},data:function(){var t=Object(c["l"])(this.$props.store.state),e=t.contextMap,n=t.contextMapYaml;return{contextMap:Object(c["i"])(e),contextMapYaml:Object(c["i"])(n)}},computed:{showDescription:function(){var t;return!(null===(t=this.selectedContext)||void 0===t||!t.description)},selectedContext:function(){var t,e=this.$props.store.state.selectedContextId;return e&&null!==(t=this.$props.store.state.contextMap.contexts.find((function(t){return t.id===e})))&&void 0!==t?t:null}},methods:{handleContextMapChanged:function(t){this.store.updateContextMap(t)},handleContextSelected:function(t){this.store.handleContextSelected(t)},handleContextPositionChanged:function(t){this.store.handleContextPositionChanged(t)}},props:{store:{type:Object,required:!0}}});n("c075");Q.render=u;var Z,tt=Q,et=n("e2c1"),nt=n("2ef0"),ot=n.n(nt);window.jsyaml=et["a"];var rt=function(t){try{var e=et["a"].load(t);return{contextMap:e}}catch(n){return console.log("Invalid YAML"),{contextMap:{contexts:[]},error:n}}},at=function(){function t(){Object(r["a"])(this,t),Object(i["a"])(this,"debug",!1),Object(i["a"])(this,"state",Object(c["h"])({contextMapYaml:it,contextMap:rt(it).contextMap,selectedContextId:null}))}return Object(a["a"])(t,[{key:"updateYaml",value:function(t){this.state.contextMapYaml=t,window.localStorage.setItem("lastMap",t)}},{key:"updateContextMap",value:function(t){this.debug&&console.log("setMessageAction triggered with",t);var e=rt(t),n=e.contextMap,o=e.error;o||(this.state.contextMap=n),this.updateYaml(t)}},{key:"handleContextSelected",value:function(t){var e;this.state.selectedContextId=null!==(e=null===t||void 0===t?void 0:t.id)&&void 0!==e?e:null}},{key:"handleContextPositionChanged",value:function(t){this.debug&&console.log("handleContextPositionChanged triggered with",t);var e=ot.a.cloneDeep(this.state.contextMap),n=e.contexts.find((function(e){return e.id===t.contextId}));if(n){var r=n["x-viz-metadata"];n["x-viz-metadata"]=Object(o["a"])(Object(o["a"])({},r),{},{position:t.position});try{var a=et["a"].dump(e,{skipInvalid:!0,lineWidth:-1});this.updateYaml(a),this.state.contextMap=e,console.log(["Updated Position",t,e,a])}catch(i){console.log(i)}}}}]),t}(),it=null!==(Z=window.localStorage.getItem("lastMap"))&&void 0!==Z?Z:"---\ncontexts:\n  - id: test\n    name: test\n    relations:\n      - target: test2\n  - id: test2\n    name: test-2",ct=new at,lt=Object(c["b"])(tt,{store:ct});lt.mount("#app")},dfe4:function(t,e,n){}});
//# sourceMappingURL=app.3c558887.js.map